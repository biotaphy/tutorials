<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Webinar 3: Split and merge occurrence data by species &mdash; Biotaphy Tutorials 1.0a1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Webinar 5: Resolve taxonomy in occurrence data" href="w5_resolve_occurrence_names.html" />
    <link rel="prev" title="Webinar 2: Resolve taxonomy for a list" href="w2_resolve_splist_names.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Biotaphy Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pages/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="w1_overview.html">Webinar 1: Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="w2_resolve_splist_names.html">Webinar 2: Resolve taxonomy for a list</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Webinar 3: Split and merge occurrence data by species</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-preparation">Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-occurrence-records">Input: occurrence records</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-wrangler-configuration-file">Input: Wrangler configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-script-parameter-file">Input: Script parameter file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-tutorial-with-dwca-data">Run tutorial with DwCA data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="w5_resolve_occurrence_names.html">Webinar 5: Resolve taxonomy in occurrence data</a></li>
<li class="toctree-l1"><a class="reference internal" href="w5_wrangle_occurrences.html">Webinar 5: Clean Occurrence Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="w7a_build_grid.html">Webinar 7: Build a grid to analyze a multi-species dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="w7b_encode_layers.html">Webinar 7: Encode Layers into a Presence-Absence matrix (PAM) for multi-species analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="w7c_calc_pam_stats.html">Webinar 7: Calculate statistics for a PAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="w8a_resolve_tree_names.html">Webinar 8: Resolve names in a phylogenetic tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="w8b_compute_pd.html">Webinar 8: Compute Phylogenetic Diversity (PD) for a PAM with a tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrangle_species_list.html">Species List: Wrangling</a></li>
<li class="toctree-l1"><a class="reference internal" href="script_params.html">Script parameters file</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_wrangle_occurrence.html">Specimen Occurrences: Data and Wrangling</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_wrangle_tree.html">Trees: Data and Wrangling</a></li>
<li class="toctree-l1"><a class="reference internal" href="idigbio_download.html">Download occurrence data from iDigBio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/glossary.html">Biotaphy Tutorial Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Biotaphy Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Webinar 3: Split and merge occurrence data by species</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/w3_split_occurrence_data.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="webinar-3-split-and-merge-occurrence-data-by-species">
<h1>Webinar 3: Split and merge occurrence data by species<a class="headerlink" href="#webinar-3-split-and-merge-occurrence-data-by-species" title="Permalink to this heading"></a></h1>
<p><strong>Webinar 3</strong>, <a class="reference external" href="https://docs.google.com/document/d/1CqYkCUlY40p8NnqM-GtcLju70jrAG45FGejJ26sS3_U/edit#heading=h.eax09dyp58l1">Big Data Munging</a>
(Module 2, Big-Data approaches).</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>Read <a class="reference internal" href="w1_overview.html"><span class="doc std std-doc">Tutorial Overview</span></a> for an overview of how all
tutorials work.</p>
</section>
<section id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading"></a></h2>
<section id="input-occurrence-records">
<h3>Input: occurrence records<a class="headerlink" href="#input-occurrence-records" title="Permalink to this heading"></a></h3>
<p>The split_occurrence_data tool accepts either a Darwin Core Archive (DwCA) file or a
CSV file containing records for one or more taxa.  More information is in the
<strong>Occurrence Data</strong> section of <a class="reference internal" href="data_wrangle_occurrence.html"><span class="doc std std-doc">data_wrangle_occurrence</span></a>.</p>
</section>
<section id="input-wrangler-configuration-file">
<h3>Input: Wrangler configuration file<a class="headerlink" href="#input-wrangler-configuration-file" title="Permalink to this heading"></a></h3>
<p>A data wrangler configuration is a file containing a JSON list of zero or more
wranglers - each performs a different operation, and each has its own parameters.
More information on file format, available wrangler types, and the required and/or
optional parameters for each are in the <strong>Occurrence Wrangler Types</strong> section
of <a class="reference internal" href="data_wrangle_occurrence.html"><span class="doc std std-doc">data_wrangle_occurrence</span></a>.  In the first example, we will
split occurrence data, but not perform any other wrangling on it, so our <span class="xref myst">wrangler
configuration file</span> contains an empty list.  A
second example <span class="xref myst">wrangler configuration file</span>
resolves names with GBIF before grouping the data by name.</p>
<p>If more than one dataset is being processed, it is logical to apply the same wranglers
to each.</p>
</section>
<section id="input-script-parameter-file">
<h3>Input: Script parameter file<a class="headerlink" href="#input-script-parameter-file" title="Permalink to this heading"></a></h3>
<p>A JSON parameter file is required for this command.  Three tutorial parameter files are
<a class="reference download internal" download="" href="../_downloads/dcdfe5e9bd8291646a28db90400c3618/split_occurrence_data_dwca.json"><span class="xref download myst">split_occurrence_data_dwca.json</span></a>,
<a class="reference download internal" download="" href="../_downloads/f8d9a818db1c03c7022f4f8a3389f71b/split_occurrence_data_csv.json"><span class="xref download myst">split_occurrence_data_csv.json</span></a>,
and
<a class="reference download internal" download="" href="../_downloads/427ee628e480fee1563537d393774814/split_wrangle_occurrence_data.json"><span class="xref download myst">split_wrangle_occurrence_data.json</span></a>.</p>
<p>These are the required and optional parameters:</p>
<p>Required:</p>
<ul class="simple">
<li><p><strong>out_dir</strong>: Directory where the output data should be written.  If the directory
does not exist, it will be created</p></li>
</ul>
<p>Optional:</p>
<ul class="simple">
<li><p><strong>max_open_writers</strong>: The maximum number of data writers to have open at once.</p></li>
<li><p><strong>key_field</strong>: <strong>BUGGY - IGNORE THIS FOR NOW</strong> -
The field name (or names) to use for filenames.  This/these must be
encased in square brackets, i.e. <code class="docutils literal notranslate"><span class="pre">&quot;key_field&quot;:</span> <span class="pre">[&quot;scientificName&quot;]</span></code>. If multiple
fields are provided, the ordered fields specify the sub-directory structure used for
organizing files.  The first field will specify the directory directly under
out_dir, and so on.  The final field will be contain the base filename.  These
fields should be hierarchical.  For example, if grouping records into files by
species, with a dataset containing 2000 species, using taxonomic grouping fields
(in order from coarser to finer groups)
such as <code class="docutils literal notranslate"><span class="pre">&quot;key_field&quot;:</span> <span class="pre">[&quot;family&quot;,</span> <span class="pre">&quot;genus&quot;,</span> <span class="pre">&quot;species&quot;]</span></code> would create a file
with records for the Giant Panda in
“&lt;out_dir&gt;/Ursidae/Ailuropoda/Ailuropoda melanoleuca.csv”.
If this parameter is not specified, it will default to the fieldname for grouping
data.  This is a required argument for CSV files and defaults to “scientificName”
in DwCA files.  If there are more groups/files than are allowed in a directory, the
files will be written to subdirectories by the beginning characters in the species
name.</p></li>
<li><p><strong>out_field</strong>: The field name or names of columns to be included in output CSV files.
If this field is left out, all fields from the first successfully processed record
will be included in outputs.</p></li>
<li><p><strong>dwca</strong>: This is an optional argument, but either this, or <strong>csv</strong>, must be provided.
List of 0 or more lists, each containing 2 arguments</p>
<ul>
<li><p>input DwCA file, and</p></li>
<li><p>occurrence data wrangler configuration file (described in the next section). The
example split_occurrence_data wrangler configuration used for this tutorial step
is <span class="xref myst">here</span></p></li>
</ul>
</li>
<li><p><strong>csv</strong>: This is an optional argument, but either this, or <strong>dwca</strong>, must be provided.
List of 0 or more lists, each containing 5 arguments</p>
<ul>
<li><p>input CSV file</p></li>
<li><p>occurrence data wrangler configuration file (described in the next section).</p></li>
<li><p>fieldname for grouping data (often a taxonomic designation such as scientificName)</p></li>
<li><p>fieldname for the longitude/x coordinate</p></li>
<li><p>fieldname for the latitude/y coordinate</p></li>
</ul>
</li>
<li><p><strong>species_list_filename</strong>: File location to write list of species seen (after
wrangling).</p></li>
</ul>
</section>
</section>
<section id="run-tutorial-with-dwca-data">
<h2>Run tutorial with DwCA data<a class="headerlink" href="#run-tutorial-with-dwca-data" title="Permalink to this heading"></a></h2>
<p>Initiate the split_occurrence_data process with the following:</p>
<p>for linux/mac systems</p>
<div class="highlight-zsh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test missing input file</span>
./run_tutorial.sh split_occurrence_data data/config/split_occurrence_data_missing_wrangler.json
<span class="c1"># with CSV data</span>
./run_tutorial.sh split_occurrence_data data/config/split_occurrence_data_csv.json
<span class="c1"># with DwCA data</span>
./run_tutorial.sh split_occurrence_data data/config/split_occurrence_data_dwca.json
<span class="c1"># with 1 DwCA and 2 CSV and resolving names with GBIF</span>
./run_tutorial.sh split_occurrence_data data/config/split_wrangle_occurrence_data.json
</pre></div>
</div>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this heading"></a></h2>
<p>This process outputs files configured in the script parameter file, similar to the
following:</p>
<ol class="arabic simple">
<li><p>TODO: text to the console as it processes each name.</p></li>
<li><p>TODO: a log file named in the log_filename parameter, similar to <span class="xref myst"></span></p></li>
<li><p>TODO: a report file named in the report_filename parameter, similar to
<span class="xref myst"></span>, containing a summary of the processing.</p></li>
<li><p>a directory, named in the out_dir parameter, of output CSV files, one per species (or
other grouping field).  The basename of each CSV file will be named by the value in
the grouping field.</p></li>
</ol>
<p>The process also produces outputs according to the wrangler configuration file:</p>
<ol class="arabic simple">
<li><p>If the AcceptedNameOccurrenceWrangler is included, and there is a name-map file
named in out_map_filename parameter, this file will be output.<br />
The name-map is a JSON file with pairs of names -
the original name to the accepted name according to the specified authority.<br />
This name-map is suitable to use for input when resolving another dataset containing
a subset of the same original names.  A sample output name-map is
<span class="xref myst">gbif_occ.namemap</span>.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="w2_resolve_splist_names.html" class="btn btn-neutral float-left" title="Webinar 2: Resolve taxonomy for a list" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="w5_resolve_occurrence_names.html" class="btn btn-neutral float-right" title="Webinar 5: Resolve taxonomy in occurrence data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Biotaphy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>