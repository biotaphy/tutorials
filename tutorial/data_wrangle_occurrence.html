<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Specimen Occurrences: Data and Wrangling &mdash; Biotaphy Tutorials 1.0a1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Biotaphy Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/installation.html">Tutorial Preparation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Biotaphy Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Specimen Occurrences: Data and Wrangling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/data_wrangle_occurrence.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="specimen-occurrences-data-and-wrangling">
<h1>Specimen Occurrences: Data and Wrangling<a class="headerlink" href="#specimen-occurrences-data-and-wrangling" title="Permalink to this heading"></a></h1>
<section id="occurrence-data">
<h2>Occurrence Data<a class="headerlink" href="#occurrence-data" title="Permalink to this heading"></a></h2>
<p>Several tools (<a class="reference external" href="w5_split_occurrence_data.rst">split_occurrence_data</a>,
<a class="reference external" href="w3_wrangle_occurrence_data">wrangle_occurrences</a>) accept occurrence data.
The filename must be specified in the script parameter file, described in each tool’s
documentation and linked above.  Data can be in one of two formats:</p>
<ol class="arabic simple">
<li><p>Darwin Core Archive (DwCA) file.  DwCA files may be downloaded from several places,
including GBIF and iDigBio.</p>
<ol class="arabic simple">
<li><p>To download from GBIF, choose your filters in the
<a class="reference external" href="https://www.gbif.org/occurrence">GBIF portal</a>.  For example, the example data
was downloaded after selecting occurrences where
<a class="reference external" href="https://www.gbif.org/occurrence/search?taxon_key=3032645&amp;occurrence_status=present">genus=’Heuchera L’</a>
Then choose the download link at the upper right column header.</p></li>
<li><p>To download from iDigBio, instructions for querying and downloading from the
command prompt are at <a class="reference external" href="idigbio_download">idigbio_download</a>.</p></li>
<li><p>The tutorial example DwCA is at
<a class="reference external" href="../../data/input/occurrence_idigbio.zip">occurrence_idigbio.zip</a></p></li>
</ol>
</li>
<li><p>CSV file containing records for one or more taxa.</p>
<ol class="arabic simple">
<li><p>A CSV file is a text file with one species occurrence record per line.  The file
must be a delimited text file, and the first line must contain field names.  Each
record/line must contain a species (or other group) identifier, such as
scientificName or species_name, and x and y coordinates indicating a geographic
location.  The field names for these 3 columns are specified in the script
parameter file. One simple tutorial example occurrence datafile
is <a class="reference external" href="../../data/input/heuchera.csv">heuchera.csv</a> which contains different
heuchera species, grouped by name, with x and y coordinates.  Another tutorial
example file is a CSV file containing many fields, downloaded from gbif,
<a class="reference external" href="../../data/input/occurrence_gbif.csv">occurrence_gbif.csv</a>.</p></li>
</ol>
</li>
</ol>
<p>All point records will have the fields “species_name”, “x”, and “y” appended to the
attributes, and they will be filled with the values from the original fields defined as
containing these types of data.  When resolving names with the
AcceptedNameOccurrenceWrangler.
new resolved name will be updated in the “species_name” field.</p>
</section>
<section id="wrangler-configuration-file">
<h2>Wrangler configuration file<a class="headerlink" href="#wrangler-configuration-file" title="Permalink to this heading"></a></h2>
<p>A file specifying 0 or more wranglers to apply to the tree data, and options
specific to each.  Configuration files:</p>
<ul class="simple">
<li><p>are in JSON format, a list of desired wranglers.</p></li>
<li><p>Each wrangler is a dictionary.</p></li>
<li><p>Each dictionary must contain “wrangler_type”, with the name of the wrangler type.</p></li>
<li><p>The dictionary will also contain all required parameters and any optional parameters.</p></li>
</ul>
<p>If an operation, such as split_occurrence_data requires a wrangle configuration file,
and no other data manipuation is requested, the configuration file can contain an empty
list, such as:  <a class="reference external" href="../../data/wranglers/no_wrangle.rst">no_wrangle</a>.</p>
</section>
<section id="occurrence-wrangler-types">
<h2>Occurrence Wrangler Types<a class="headerlink" href="#occurrence-wrangler-types" title="Permalink to this heading"></a></h2>
<p>When running wranglers on an occurrence data set, wranglers are applied in the order
that they are listed in the wrangler config file.</p>
<p>Currently, wrangler_type names correspond to the wrangler class <cite>name</cite> attribute in
this module’s files.  Each wrangler’s parameters correspond to the constructor
arguments for that wrangler.</p>
<p><strong>Note</strong> that two wranglers (MinimumPointsWrangler, UniqueLocalitiesFilter) assess a
set of points, not individual points.  The set of points is defined by consecutive
points with the same species key in a file/dataset.
If points for a single species are not in a single file, or grouped in a file, these
wranglers will not work as intended.  These wranglers should be
used when running <cite>split_occurrence_data</cite> or <cite>wrangle_occurrence_data</cite> only with input
data grouped by species.</p>
<section id="acceptednameoccurrencewrangler">
<h3>AcceptedNameOccurrenceWrangler<a class="headerlink" href="#acceptednameoccurrencewrangler" title="Permalink to this heading"></a></h3>
<p>The AcceptedNameOccurrenceWrangler matches the value in the occurrence data identified
as the “species” field with an “accepted name” as defined in a name-map or by a
taxonomic service.</p>
<ul class="simple">
<li><p>optional</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>name_map (str or dict): A dictionary or filename containing a dictionary of original</dt><dd><p>name to accepted name.  Defaults to None, but either this or name_resolver
<strong>must be</strong> provided.</p>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>name_resolver (str or Method): Use this method for getting new
accepted names. If set to ‘gbif’ or ‘otol’, use GBIF or OTOL name resolution
respectively.  Defaults to None, but either this or name_map must be provided.</p></li>
<li><p>out_map_filename (str): Output for name-mapping between original and accepted names.
This file is then acceptable for use as a <strong>name-map</strong> input for subsequent
name wrangling.  Defaults to None.</p></li>
<li><p>map_write_interval (int): Interval at which to write records to disk.  Used to
ensure that if something fails, all is not lost. Defaults to 100.</p></li>
<li><p>out_map_format (str): Type of file format for out_map_filename, defaults to “json”.</p></li>
<li><p>store_original_attribute (str): A new attribute to store the original taxon name.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="attributefilterwrangler">
<h3>AttributeFilterWrangler<a class="headerlink" href="#attributefilterwrangler" title="Permalink to this heading"></a></h3>
<p>The AttributeFilterWrangler filters out points based on whether the value in the
given attribute passes the given function.</p>
<ul class="simple">
<li><p>required</p>
<ul>
<li><p>attribute_name (str): The name of the attribute to modify.</p></li>
<li><p>filter_func (Method): A function to be used for the pass condition.</p></li>
</ul>
</li>
</ul>
</section>
<section id="attributemodifierwrangler">
<h3>AttributeModifierWrangler<a class="headerlink" href="#attributemodifierwrangler" title="Permalink to this heading"></a></h3>
<p>The AttributeModifierWrangler modifies a newly added or existing attribute, computing
the value with the given function.</p>
<ul class="simple">
<li><p>required</p>
<ul>
<li><p>attribute_name (str): The name of the attribute to modify.</p></li>
<li><p>attribute_func (Method): A function to generate values for a point.</p></li>
</ul>
</li>
</ul>
</section>
<section id="boundingboxfilter">
<h3>BoundingBoxFilter<a class="headerlink" href="#boundingboxfilter" title="Permalink to this heading"></a></h3>
<p>The BoundingBoxFilter filters out occurrence points if they do not fall within the given
bounding box.</p>
<ul class="simple">
<li><p>required</p>
<ul>
<li><p>min_x (numeric): The minimum ‘x’ value for the bounding box.</p></li>
<li><p>min_y (numeric): The minimum ‘y’ value for the bounding box.</p></li>
<li><p>max_x (numeric): The maximum ‘x’ value for the bounding box.</p></li>
<li><p>max_y (numeric): The maximum ‘y’ value for the bounding box.</p></li>
</ul>
</li>
</ul>
</section>
<section id="commonformatwrangler">
<h3>CommonFormatWrangler<a class="headerlink" href="#commonformatwrangler" title="Permalink to this heading"></a></h3>
<p>The CommonFormatWrangler modifies points to a common format, using the given
attribute-map between the original fields, and the desired fields in the common format.</p>
<ul class="simple">
<li><p>required</p>
<ul>
<li><p>attribute_map (dict): A mapping of source key, target values.</p></li>
</ul>
</li>
</ul>
</section>
<section id="coordinateconverterwrangler">
<h3>CoordinateConverterWrangler<a class="headerlink" href="#coordinateconverterwrangler" title="Permalink to this heading"></a></h3>
<p>The CoordinateConverterWrangler modifies occurrence points by transforming the
x and y coordinates from one projection (coded as an EPSG number) into another
projection.  The new coordinates overwrite the x and y fields.  If original_x_attribute
and original_y_attribute are provided, these should be new fields in which to save
the original x and y coordinates.</p>
<ul class="simple">
<li><p>required</p>
<ul>
<li><p>target_epsg (int): Target map projection specified by EPSG code.</p></li>
</ul>
</li>
<li><p>optional</p>
<ul>
<li><p>source_epsg (int): Source map projection specified by EPSG code.  Either this or
epsg_attribute MUST be provided.</p></li>
<li><p>epsg_attribute (str or None): A point attribute containing EPSG code.  Either this
or source_epsg MUST be provided.</p></li>
<li><p>original_x_attribute (str): An attribute to store the original x value.</p></li>
<li><p>original_y_attribute (str): An attribute to store the original y value.</p></li>
</ul>
</li>
</ul>
</section>
<section id="decimalprecisionfilter">
<h3>DecimalPrecisionFilter<a class="headerlink" href="#decimalprecisionfilter" title="Permalink to this heading"></a></h3>
<p>The DecimalPrecisionFilter filters out occurrence points where one or both coordinates
have values where the number of digits to the right of the decimal point is less than
the given number.</p>
<ul class="simple">
<li><p>required:</p>
<ul>
<li><p>decimal_places (int): Only keep points with at least this many decimal places of
precision.</p></li>
</ul>
</li>
</ul>
</section>
<section id="disjointgeometriesfilter">
<h3>DisjointGeometriesFilter<a class="headerlink" href="#disjointgeometriesfilter" title="Permalink to this heading"></a></h3>
<p>The DisjointGeometriesFilter filters out points where the coordinates intersect with
the given geometries.</p>
<ul class="simple">
<li><p>required:</p>
<ul>
<li><p>geometry_wkts (list of str): A list of geometry WKTs to check against.</p></li>
</ul>
</li>
</ul>
</section>
<section id="intersectgeometriesfilter">
<h3>IntersectGeometriesFilter<a class="headerlink" href="#intersectgeometriesfilter" title="Permalink to this heading"></a></h3>
<p>The IntersectGeometriesFilter filters out points where the coordinates do NOT intersect
with the given geometries.</p>
<ul class="simple">
<li><p>required:</p>
<ul>
<li><p>geometry_wkts (list of str): A list of WKT strings.</p></li>
</ul>
</li>
</ul>
</section>
<section id="minimumpointswrangler">
<h3>MinimumPointsWrangler<a class="headerlink" href="#minimumpointswrangler" title="Permalink to this heading"></a></h3>
<p>See the <a class="reference external" href="#OccurrenceWranglerTypes">Note</a> above for important information on the use
of this wrangler.</p>
<p>The MinimumPointsWrangler filters out groups of points where the number of points in a
group does not meet the minimum.</p>
<ul class="simple">
<li><p>required:</p>
<ul>
<li><p>minimum_count (int): The minimum number of points in order to keep all.</p></li>
</ul>
</li>
</ul>
</section>
<section id="spatialindexfilter">
<h3>SpatialIndexFilter<a class="headerlink" href="#spatialindexfilter" title="Permalink to this heading"></a></h3>
<p>The SpatialIndexFilter filters out points that match some given condition
(check_hit_function) on the given spatial index.</p>
<ul class="simple">
<li><p>required:</p>
<ul>
<li><p>spatial_index (SpatialIndex): A SpatialIndex object that can be searched.</p></li>
<li><p>intersections_map (dict): A dictionary of species name keys and corresponding valid
intersection values.</p></li>
<li><p>check_hit_func (Method): A function that takes two arguments (search hit, valid
intersections for a species) and returns a boolean indication if the hit should be
counted.</p></li>
</ul>
</li>
</ul>
</section>
<section id="uniquelocalitiesfilter">
<h3>UniqueLocalitiesFilter<a class="headerlink" href="#uniquelocalitiesfilter" title="Permalink to this heading"></a></h3>
<p>See the <a class="reference external" href="#OccurrenceWranglerTypes">Note</a> above for important information on the use
of this wrangler.</p>
<p>The UniqueLocalitiesFilter filters out points from a grouping that do not have unique
coordinates.  The filter can operate on one or more groups, and uniqueness is only
checked within groups.</p>
<ul class="simple">
<li><p>optional parameters:</p>
<ul>
<li><p>do_reset (bool): Reset the list of seen localities after each group.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Biotaphy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>